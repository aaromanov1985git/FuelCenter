Функция ВыполнитьHTTPЗапросППР(URL, Ресурс, Токен, Метод)  

	Попытка
		ЗаголовокЗапросаHTTP = Новый Соответствие();  
		ЗаголовокЗапросаHTTP.Вставить("Content-Type", "application/json");
		ЗаголовокЗапросаHTTP.Вставить("Authorization", Токен); 
		
		// ИСПРАВЛЕНИЕ: Извлекаем хост и порт из URL
		// URL может быть в формате "http://10.35.1.200:8000" или "https://10.35.1.200:8000"
		Хост = "";
		Порт = 80;
		ИспользоватьSSL = Ложь;
		
		ЧастиURL = СтрРазделить(URL, "://");
		Если ЧастиURL.Количество() = 2 Тогда
			// Определяем протокол
			Протокол = ЧастиURL[0]; // "http" или "https"
			ИспользоватьSSL = (Протокол = "https");
			
			// Получили протокол и хост:порт
			ХостИПорт = ЧастиURL[1]; // "10.35.1.200:8000"
			ЧастиХостПорт = СтрРазделить(ХостИПорт, ":");
			Если ЧастиХостПорт.Количество() = 2 Тогда
				Хост = ЧастиХостПорт[0]; // "10.35.1.200"
				Порт = Число(ЧастиХостПорт[1]); // 8000
			Иначе
				// Если порт не указан, используем хост как есть и порт по умолчанию
				Хост = ХостИПорт;
			Если ИспользоватьSSL Тогда
				Порт = 443;  // HTTPS порт
			Иначе
				Порт = 80;   // HTTP порт
			КонецЕсли;
			КонецЕсли;
		Иначе
			// Если URL не содержит "://", считаем что это уже хост
			Хост = URL;
			// По умолчанию используем HTTPS для безопасности
			ИспользоватьSSL = Истина;
			Порт = 443;
		КонецЕсли;
		
		// Создаем HTTP соединение с правильными параметрами
		// Для HTTP не используем SSL, для HTTPS - используем
		Если ИспользоватьSSL Тогда
			ssl = Новый ЗащищенноеСоединениеOpenSSL();
			Соединение = Новый HTTPСоединение(Хост, Порт,,,,,ssl);
		Иначе
			// Для HTTP соединения SSL не нужен
			Соединение = Новый HTTPСоединение(Хост, Порт);
		КонецЕсли;
		
		// Создаем HTTP запрос с ресурсом и заголовками
		HTTPЗапрос = Новый HTTPЗапрос(Ресурс, ЗаголовокЗапросаHTTP);
		
		// Выполняем GET запрос
		Ответ = Соединение.Получить(HTTPЗапрос);
		
	Исключение
		Сообщить("Ошибка работы " + Метод + " Исключение (Соединение.Получить) " + Ресурс + " " + ОписаниеОшибки());
		Возврат Неопределено;
	КонецПопытки;

	// Проверяем код состояния ответа
	Если Ответ.КодСостояния <> 200 Тогда
		Сообщить("Ошибка работы " + Метод + " Ответ.КодСостояния <> 200 " + Ресурс + " " + Ответ.ПолучитьТелоКакСтроку());
		Возврат Неопределено;
	Конецесли;

	// Получаем тело ответа
	ТелоОтвета = Ответ.ПолучитьТелоКакСтроку();
	
	Попытка
		// Парсим JSON ответ
		ЧтениеJSON = Новый ЧтениеJSON;
		ЧтениеJSON.УстановитьСтроку(ТелоОтвета);
		СоотвИзJSON = ПрочитатьJSON(ЧтениеJSON);
	Исключение
		Сообщить("Ошибка работы " + Метод + " Исключение (ПрочитатьJSON) " + Ресурс + " " + ОписаниеОшибки());
		Возврат Неопределено;
	КонецПопытки;

	Возврат СоотвИзJSON;

КонецФункции

