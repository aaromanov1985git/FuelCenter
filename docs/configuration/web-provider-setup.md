# Настройка подключения к веб-провайдеру

## Описание

Добавлена поддержка подключения к веб-сервисам, которые требуют авторизацию через JWT токен (например, сервис по адресу http://176.222.217.51:8080).

## Тип подключения "web"

Новый тип подключения `web` позволяет подключаться к веб-сервисам, которые:
- Требуют авторизацию через API endpoint `/api/auth/login`
- Используют JWT токены для доступа к данным
- Предоставляют список карт через `/api/cards`

## Настройка шаблона провайдера

### Параметры подключения (connection_settings)

Для типа подключения `web` необходимо указать следующие параметры в JSON формате:

```json
{
  "base_url": "http://176.222.217.51:8080",
  "username": "8614006094т",
  "password": "8614006094т",
  "currency": "RUB"
}
```

### Параметры:

- **base_url** (обязательный) - Базовый URL веб-сервиса
- **username** (обязательный) - Имя пользователя для авторизации (также может быть `login` или `user`)
- **password** (обязательный) - Пароль для авторизации (также может быть `pass`)
- **currency** (опциональный) - Валюта по умолчанию (по умолчанию "RUB")

## Пример использования

### 1. Создание шаблона через API

```bash
POST /api/templates
{
  "provider_id": 1,
  "name": "Веб-провайдер",
  "description": "Подключение к веб-сервису",
  "connection_type": "web",
  "connection_settings": {
    "base_url": "http://176.222.217.51:8080",
    "username": "8614006094т",
    "password": "8614006094т"
  },
  "field_mapping": {}
}
```

### 2. Тестирование подключения

```bash
POST /api/templates/test-api-connection?connection_type=web
{
  "base_url": "http://176.222.217.51:8080",
  "username": "8614006094т",
  "password": "8614006094т"
}
```

### 3. Загрузка транзакций

```bash
POST /api/transactions/load-from-api?template_id=1&date_from=2025-01-01&date_to=2025-01-31
```

## Текущие ограничения

⚠️ **Важно**: API endpoint для получения транзакций по картам пока не найден. Метод `fetch_card_transactions` возвращает пустой список.

Для получения транзакций необходимо:
1. Найти правильный API endpoint в документации сервиса
2. Или реализовать веб-скрапинг для получения данных

## Реализованная функциональность

✅ Авторизация через `/api/auth/login`  
✅ Получение списка карт через `/api/cards`  
✅ Проверка подключения (healthcheck)  
✅ Поддержка автоматической загрузки  
✅ Интеграция с системой шаблонов  

## Архитектура

- **WebAdapter** - адаптер для работы с веб-сервисом
- **ApiProviderService** - расширен для поддержки типа "web"
- **AutoLoadService** - поддерживает автоматическую загрузку для типа "web"

## Дальнейшее развитие

Для полной функциональности необходимо:
1. Найти или реализовать endpoint для получения транзакций
2. Добавить поддержку refresh токенов (если требуется)
3. Реализовать обработку ошибок авторизации
4. Добавить поддержку веб-скрапинга (если API недоступен)
