# Миграции Базы Данных

Проект использует Alembic для управления миграциями базы данных.

## Быстрый старт

### Применение миграций

```bash
# Применить все миграции
alembic upgrade head

# Откатить последнюю миграцию
alembic downgrade -1

# Показать текущую версию
alembic current

# Показать историю миграций
alembic history
```

### Создание новой миграции

```bash
# Автогенерация миграции на основе изменений в моделях
alembic revision --autogenerate -m "Описание изменений"

# Создание пустой миграции (для ручных изменений)
alembic revision -m "Описание изменений"
```

## Автоматическое применение миграций

При старте приложения миграции применяются автоматически. В production рекомендуется применять миграции вручную перед деплоем:

```bash
# Перед деплоем
alembic upgrade head

# Затем запустить приложение
uvicorn app.main:app --host 0.0.0.0 --port 8000
```

## Структура миграций

- `alembic/` - директория с миграциями
- `alembic/versions/` - файлы миграций
- `alembic/env.py` - конфигурация Alembic
- `alembic.ini` - основной конфигурационный файл

## Важные замечания

1. **Всегда проверяйте автогенерированные миграции** перед применением
2. **Делайте бэкап БД** перед применением миграций в production
3. **Тестируйте миграции** на staging окружении
4. **Не редактируйте примененные миграции** - создавайте новые

## Откат миграций

```bash
# Откатить на одну версию назад
alembic downgrade -1

# Откатить до конкретной версии
alembic downgrade <revision_id>

# Откатить все миграции
alembic downgrade base
```

## Скрипт для применения миграций

Используйте скрипт `scripts/migrate.py` для программного применения миграций:

```python
from scripts.migrate import run_migrations
run_migrations()
```
