# Установка и настройка Playwright

## Для решения проблемы 403 Forbidden

Если веб-сервис блокирует простые HTTP запросы (ошибка 403), система автоматически попробует использовать Playwright для полной имитации браузера.

## Установка

### 1. Установка библиотеки Playwright

```bash
pip install playwright
```

### 2. Установка браузера Chromium

```bash
playwright install chromium
```

Или для всех браузеров:
```bash
playwright install
```

## Как это работает

1. **Первый подход**: Система пытается авторизоваться через обычные HTTP запросы с имитацией браузера
2. **При ошибке 403**: Автоматически запускается Playwright
3. **Playwright**: 
   - Открывает реальный браузер (Chromium)
   - Загружает страницу логина
   - Выполняет JavaScript (если требуется)
   - Заполняет форму логина
   - Нажимает кнопку входа
   - Перехватывает ответ API и извлекает токен
   - Закрывает браузер

## Преимущества

- ✅ Полная имитация браузера
- ✅ Выполнение JavaScript
- ✅ Работа с cookies и localStorage
- ✅ Обход большинства защит от ботов
- ✅ Автоматическое переключение при ошибке 403

## Недостатки

- ⚠️ Требует установки браузера (~200MB)
- ⚠️ Больше ресурсов (память, CPU)
- ⚠️ Медленнее, чем простые HTTP запросы

## Проверка установки

После установки Playwright, проверьте, что все работает:

```python
from playwright.async_api import async_playwright

async def test():
    async with async_playwright() as p:
        browser = await p.chromium.launch()
        page = await browser.new_page()
        await page.goto("https://example.com")
        print(f"Title: {await page.title()}")
        await browser.close()

# Запуск: asyncio.run(test())
```

## Автоматическое использование

Система автоматически использует Playwright, если:
1. Простой HTTP запрос возвращает 403 Forbidden
2. Playwright установлен и доступен
3. Все альтернативные подходы не сработали

Вам не нужно ничего настраивать дополнительно - просто установите Playwright, и система будет использовать его автоматически при необходимости.

## Устранение проблем

### Playwright не найден

Если вы видите сообщение "Playwright не установлен":
```bash
pip install playwright
playwright install chromium
```

### Ошибка при запуске браузера

Убедитесь, что все зависимости установлены:
```bash
playwright install-deps
```

### Браузер не запускается в headless режиме

Попробуйте запустить с видимым браузером (для отладки):
Измените в коде `headless=True` на `headless=False`

## Логирование

При использовании Playwright в логах будет информация:
- Открытие страницы логина
- Заполнение полей
- Нажатие кнопки
- Получение токена

Проверьте логи для диагностики проблем.
