# Технический долг (Technical Debt)

## API

### Firebird Database (FDB) - СУБД Firebird

**Дата добавления:** 2024-12-01

**Описание:**
Реализована функциональность чтения данных из базы данных Firebird Database (FDB) для провайдеров.

**Реализовано:**
- Добавлены поля в модель `ProviderTemplate`:
  - `connection_type` - тип подключения ("file" или "firebird")
  - `connection_settings` - настройки подключения к БД (JSON)
  - `source_table` - имя таблицы в БД Firebird
  - `source_query` - SQL запрос для получения данных
- Создан сервис `FirebirdService` для работы с Firebird Database
- Добавлены API endpoints:
  - `POST /api/v1/transactions/load-from-firebird` - загрузка транзакций из Firebird
  - `POST /api/v1/templates/{template_id}/test-firebird-connection` - тестирование подключения к Firebird
- Добавлена библиотека `fdb==2.0.2` для работы с Firebird

**Технический долг:**

1. **Обработка ошибок подключения:**
   - Не реализована детальная обработка различных типов ошибок Firebird (сетевые ошибки, ошибки аутентификации, ошибки SQL и т.д.)
   - Нет механизма повторных попыток подключения при временных сбоях
   - Не реализовано логирование всех SQL запросов для отладки

2. **Безопасность:**
   - Пароли подключения хранятся в открытом виде в БД (connection_settings)
   - Не реализовано шифрование чувствительных данных
   - Нет валидации SQL запросов на наличие потенциально опасных операций (DROP, DELETE, UPDATE и т.д.)

3. **Производительность:**
   - Не реализована пагинация при чтении больших объемов данных из Firebird
   - Нет кэширования результатов запросов
   - Не оптимизирована работа с большими таблицами

4. **Функциональность:**
   - Не реализована поддержка параметризованных запросов (для фильтрации по датам и т.д.)
   - Нет возможности указать кодировку подключения динамически
   - Не реализована поддержка транзакций при чтении данных
   - Нет механизма синхронизации данных (только одноразовая загрузка)

5. **Тестирование:**
   - Нет unit-тестов для FirebirdService
   - Нет интеграционных тестов для работы с реальной БД Firebird
   - Нет тестов на обработку ошибок подключения

6. **Документация:**
   - Не описаны примеры использования API для работы с Firebird
   - Нет документации по формату connection_settings
   - Не описаны ограничения и требования к структуре данных в Firebird

7. **UI:**
   - Не реализован интерфейс для настройки подключения к Firebird в шаблонах провайдеров
   - Нет визуального редактора для SQL запросов
   - Не реализован интерфейс для тестирования подключения из UI

**Рекомендации по улучшению:**

1. Добавить шифрование паролей в connection_settings
2. Реализовать валидацию SQL запросов (разрешать только SELECT)
3. Добавить пагинацию для больших выборок
4. Реализовать механизм повторных попыток подключения
5. Добавить unit и интеграционные тесты
6. Создать UI для настройки подключений к Firebird
7. Добавить мониторинг и алерты при ошибках подключения

---

## Многоязычность (i18n) - Интернационализация

**Дата добавления:** 2025-01-27

**Описание:**
Приложение в настоящее время поддерживает только русский язык. Для расширения аудитории и удобства использования необходимо добавить поддержку нескольких языков.

**Текущее состояние:**
- ❌ Все текстовые строки захардкожены в компонентах React
- ❌ Нет системы перевода
- ❌ Нет возможности переключения языка
- ❌ Сообщения об ошибках только на русском

**Технический долг:**

1. **Структура переводов:**
   - Не создана структура файлов переводов
   - Нет разделения текстов на логические группы (common, components, errors, validation)
   - Отсутствует система ключей для переводов

2. **Интеграция в Frontend:**
   - Не установлена библиотека для i18n (react-i18next, i18next)
   - Нет провайдера для переводов
   - Компоненты не используют систему переводов
   - Нет переключателя языка в UI

3. **Интеграция в Backend:**
   - Сообщения об ошибках API только на русском
   - Нет поддержки Accept-Language заголовка
   - Нет локализации дат, чисел, валют

4. **Переводы:**
   - Не переведены все текстовые строки
   - Нет переводов для английского языка
   - Не определены приоритетные языки для перевода

5. **Тестирование:**
   - Нет тестов для проверки наличия всех ключей переводов
   - Нет проверки отсутствия захардкоженных строк

**Рекомендации по улучшению:**

1. Установить и настроить `react-i18next` и `i18next`
2. Создать структуру файлов переводов:
   ```
   src/locales/
     ru/
       common.json
       components.json
       errors.json
       validation.json
     en/
       common.json
       components.json
       errors.json
       validation.json
   ```
3. Перевести все текстовые строки в компонентах на использование i18n
4. Добавить переключатель языка в настройки
5. Сохранять выбранный язык в localStorage
6. Добавить поддержку локализации в API (Accept-Language)
7. Использовать библиотеку для форматирования дат/чисел (date-fns, Intl API)

**Оценка времени:** 8-10 часов

---

## Интеграция с 1С:Предприятие

**Дата добавления:** 2025-01-27

**Описание:**
Существует базовый код интеграции с 1С в файле `backend/1C_API_Integration.bsl`, но функциональность ограничена и требует доработки.

**Текущее состояние:**
- ✅ Есть базовый код для получения транзакций из FastAPI (`backend/1C_API_Integration.bsl`)
- ❌ Интеграция только односторонняя (1С → FastAPI)
- ❌ Отсутствует обратная интеграция (FastAPI → 1С)
- ❌ Нет автоматической синхронизации
- ❌ Ограниченная обработка ошибок
- ❌ Нет UI для управления интеграцией

**Технический долг:**

1. **Односторонняя интеграция:**
   - Реализовано только получение данных из FastAPI
   - Нет механизма отправки данных в 1С
   - Нет синхронизации справочников (ТС, карты, провайдеры)

2. **Обработка ошибок:**
   - Базовая обработка ошибок, но не все сценарии покрыты
   - Нет механизма повторных попыток при сбоях
   - Нет детального логирования операций
   - Нет уведомлений об ошибках интеграции

3. **Аутентификация и безопасность:**
   - Нет системы API ключей для 1С
   - Отсутствует валидация запросов от 1С
   - Нет rate limiting для запросов от 1С
   - Пароли и секреты могут быть скомпрометированы

4. **Синхронизация данных:**
   - Нет механизма синхронизации справочников
   - Отсутствует обработка конфликтов данных
   - Нет версионирования данных
   - Нет механизма отката изменений

5. **Производительность:**
   - Нет пагинации для больших объемов данных
   - Отсутствует кэширование для частых запросов
   - Нет оптимизации запросов к БД
   - Нет batch обработки для массовых операций

6. **UI и управление:**
   - Нет интерфейса для настройки интеграции
   - Отсутствует мониторинг статуса интеграции
   - Нет журнала операций интеграции
   - Нет возможности ручного запуска синхронизации

7. **Типы интеграции:**
   - Реализована только REST API интеграция
   - Нет поддержки COM компонентов для локальной интеграции
   - Нет поддержки обмена через файлы (XML, JSON)
   - Нет поддержки веб-сервисов 1С

8. **Документация:**
   - Неполная документация по использованию API из 1С
   - Нет примеров для различных сценариев
   - Отсутствует описание форматов данных
   - Нет руководства по настройке интеграции

**Рекомендации по улучшению:**

1. **Двусторонняя интеграция:**
   - Добавить API endpoints для получения данных из 1С
   - Реализовать отправку данных в 1С через HTTP сервисы
   - Создать механизм синхронизации справочников

2. **Безопасность:**
   - Реализовать систему API ключей для 1С
   - Добавить валидацию всех входящих запросов
   - Реализовать подпись запросов (HMAC)
   - Добавить rate limiting для запросов от 1С

3. **Обработка ошибок:**
   - Улучшить обработку всех типов ошибок
   - Реализовать механизм повторных попыток
   - Добавить детальное логирование
   - Создать систему уведомлений об ошибках

4. **UI для управления:**
   - Создать раздел настроек интеграции в админ-панели
   - Добавить мониторинг статуса интеграции
   - Реализовать журнал операций
   - Добавить возможность ручного запуска синхронизации

5. **Документация:**
   - Документировать все API endpoints для 1С
   - Создать примеры кода для различных сценариев
   - Описать форматы данных и схемы
   - Создать руководство по настройке

6. **Тестирование:**
   - Создать тестовое окружение 1С для интеграции
   - Написать интеграционные тесты
   - Тестировать различные сценарии ошибок
   - Провести нагрузочное тестирование

7. **Оптимизация:**
   - Добавить пагинацию для больших выборок
   - Реализовать кэширование
   - Оптимизировать запросы к БД
   - Добавить batch обработку

**Оценка времени:** 30-40 часов

**Приоритет:** Средний (зависит от потребностей заказчика)

**Связанные файлы:**
- `backend/1C_API_Integration.bsl` - базовый код интеграции
- `backend/app/routers/transactions.py` - API endpoints
- `backend/app/services/` - бизнес-логика

